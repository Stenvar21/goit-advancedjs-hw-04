{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\n\nconst BASE_URL = 'https://pixabay.com/api/';\nconst API_KEY = '53074697-31effdba198fed340456f0d43';\n\nexport async function fetchPhotosByQuery(query, page = 1, perPage = 15) {\n  try {\n    const response = await axios.get(BASE_URL, {\n      params: {\n        key: API_KEY,\n        q: query,\n        image_type: 'photo',\n        orientation: 'horizontal',\n        safesearch: true,\n        per_page: perPage,\n        page: page,\n      },\n    });\n\n    return response.data;\n  } catch (error) {\n    console.error('Error fetching data from Pixabay API:', error);\n    throw new Error('Failed to fetch images. Please try again later.');\n  }\n}\n","export const createGalleryCardTemplate = imgInfo => {\n  return `\n    <li class=\"gallery-card\">\n      <a class=\"js-gallery-link\" href=\"${imgInfo.largeImageURL}\">\n        <img \n          class=\"gallery-img\" \n          src=\"${imgInfo.webformatURL}\" \n          alt=\"${imgInfo.tags}\" \n          loading=\"lazy\"\n        />\n      </a>\n      <div class=\"stats-container\">\n        <div class=\"stat\">\n          <span class=\"label\">Likes</span>\n          <span class=\"value\">${imgInfo.likes}</span>\n        </div>\n        <div class=\"stat\">\n          <span class=\"label\">Views</span>\n          <span class=\"value\">${imgInfo.views}</span>\n        </div>\n        <div class=\"stat\">\n          <span class=\"label\">Comments</span>\n          <span class=\"value\">${imgInfo.comments}</span>\n        </div>\n        <div class=\"stat\">\n          <span class=\"label\">Downloads</span>\n          <span class=\"value\">${imgInfo.downloads}</span>\n        </div>\n      </div>\n    </li>\n  `;\n};\n","import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nimport { fetchPhotosByQuery } from './js/pixabay-api.js';\nimport { createGalleryCardTemplate } from './js/render-functions.js';\n\nconst refs = {\n  form: document.querySelector('.js-search-form'),\n  gallery: document.querySelector('.js-gallery'),\n  loader: document.querySelector('.js-loader'),\n  loadMoreBtn: document.querySelector('.js-load-more'),\n};\n\nlet lightbox = null;\nlet currentQuery = '';\nlet currentPage = 1;\nconst PER_PAGE = 15;\nlet totalHits = 0;\n\nfunction showLoader(message = 'Loading images, please wait...') {\n  refs.loader.classList.add('is-active');\n  refs.loader.textContent = message;\n}\n\nfunction hideLoader() {\n  refs.loader.classList.remove('is-active');\n  refs.loader.textContent = '';\n}\n\nfunction showLoadMore() {\n  refs.loadMoreBtn.style.display = 'block';\n}\n\nfunction hideLoadMore() {\n  refs.loadMoreBtn.style.display = 'none';\n}\n\nfunction initOrRefreshLightbox() {\n  if (!lightbox) {\n    lightbox = new SimpleLightbox('.js-gallery a', {\n      captionsData: 'alt',\n      captionDelay: 250,\n    });\n  } else {\n    lightbox.refresh();\n  }\n}\n\nasync function fetchImages(query, page) {\n  try {\n    const data = await fetchPhotosByQuery(query, page, PER_PAGE);\n    return data;\n  } catch (err) {\n    console.error(err);\n    iziToast.error({\n      title: 'Error',\n      message: 'Something went wrong. Please try again later.',\n      position: 'topCenter',\n      timeout: 3500,\n    });\n    return { hits: [], totalHits: 0 };\n  }\n}\n\nfunction scrollToNewCards() {\n  if (currentPage === 1) return;\n\n  const allCards = refs.gallery.querySelectorAll('.gallery-card');\n  if (!allCards.length) return;\n\n  const cardWidth = allCards[0].getBoundingClientRect().width;\n  const cardHeight = allCards[0].getBoundingClientRect().height;\n\n  const cardsPerRow = Math.floor(refs.gallery.clientWidth / cardWidth);\n  const firstNewCardIndex = (currentPage - 1) * PER_PAGE;\n  const firstCardOfRow = allCards[firstNewCardIndex];\n\n  if (!firstCardOfRow) return;\n\n  const gap = parseInt(getComputedStyle(refs.gallery).gap) || 24;\n  const scrollY =\n    window.scrollY + firstCardOfRow.getBoundingClientRect().top - gap;\n\n  window.scrollTo({\n    top: scrollY,\n    behavior: 'smooth',\n  });\n}\n\nasync function onSearchFormSubmit(event) {\n  event.preventDefault();\n\n  const query = event.currentTarget.elements.user_query.value.trim();\n  if (!query) {\n    iziToast.warning({\n      title: 'Warning',\n      message: 'Search query cannot be empty!',\n      position: 'topCenter',\n      timeout: 2000,\n    });\n    return;\n  }\n\n  currentQuery = query;\n  currentPage = 1;\n  refs.gallery.innerHTML = '';\n  hideLoadMore();\n  showLoader();\n\n  const data = await fetchImages(currentQuery, currentPage);\n  const hits = data.hits || [];\n  totalHits = data.totalHits;\n\n  hideLoader();\n\n  if (!hits.length) {\n    iziToast.error({\n      title: 'Error',\n      message: 'Sorry, there are no images matching your search query.',\n      position: 'topCenter',\n      timeout: 3500,\n    });\n    return;\n  }\n\n  refs.gallery.insertAdjacentHTML(\n    'beforeend',\n    hits.map(createGalleryCardTemplate).join('')\n  );\n  initOrRefreshLightbox();\n\n  if (refs.gallery.children.length < totalHits) showLoadMore();\n}\n\nasync function onLoadMoreClick() {\n  currentPage += 1;\n  showLoader();\n  hideLoadMore();\n\n  const data = await fetchImages(currentQuery, currentPage);\n  const hits = data.hits || [];\n\n  refs.gallery.insertAdjacentHTML(\n    'beforeend',\n    hits.map(createGalleryCardTemplate).join('')\n  );\n  initOrRefreshLightbox();\n  hideLoader();\n\n  scrollToNewCards();\n\n  if (refs.gallery.children.length < totalHits) {\n    showLoadMore();\n  } else {\n    iziToast.info({\n      title: 'Info',\n      message: \"We're sorry, but you've reached the end of search results.\",\n      position: 'topCenter',\n      timeout: 3500,\n    });\n  }\n}\n\nrefs.form.addEventListener('submit', onSearchFormSubmit);\nrefs.loadMoreBtn.addEventListener('click', onLoadMoreClick);\n"],"names":["BASE_URL","API_KEY","fetchPhotosByQuery","query","page","perPage","axios","error","createGalleryCardTemplate","imgInfo","refs","lightbox","currentQuery","currentPage","PER_PAGE","totalHits","showLoader","message","hideLoader","showLoadMore","hideLoadMore","initOrRefreshLightbox","SimpleLightbox","fetchImages","err","iziToast","scrollToNewCards","allCards","cardWidth","firstNewCardIndex","firstCardOfRow","gap","scrollY","onSearchFormSubmit","event","data","hits","onLoadMoreClick"],"mappings":"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"}